<!DOCTYPE html>
<html>

<head>
    <title>User Page</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        function getCookieValue(cookieName) {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.startsWith(cookieName + '=')) {
                    return cookie.substring(cookieName.length + 1);
                }
            }
            return '';
        }

        function addnewtask() {
            //code to open add task menu on center of screen
            document.getElementById("addtaskdiv").style.display = "flex";
        }

        function addnewtaskclose() {
            document.getElementById("addtaskdiv").style.display = "none";
        }

        function welcomedisplay() {
            var date = new Date();
            document.getElementById("welcomedisplay").textContent = (date.getMonth() + 1) + "-" + date.getDate() + ", " + date.toLocaleTimeString() + " - Welcome " + getCookieValue("username");
        }

        function allthestuff() {
            setInterval(welcomedisplay, 100);
            welcomedisplay();
            document.getElementById("addtaskdiv").style.display = "none";
        }
    </script>
</head>

<body onload="allthestuff()">
    <div class="bg-gradient-to-b from-orange-400 to-orange-700 flex flex-col">
        <div class="h-screen p-3">
            <div class="bg-black bg-opacity-20 shadow-lg rounded-md flex-grow flex-shrink-0 p-2 h-48">

            </div>
            <br>
            <p id="welcomedisplay" class="text-white font-bold text-4xl">lmao if you see this the webpage messed up lol
            </p>
            <br>

            <span>
                <button class="bg-white text-black font-bold text-lg rounded-lg shadow-md p-5 hover:bg-slate-300"
                    onclick="addnewtask()">Add Task</button>
            </span>
            <span>
                <button class="bg-white text-black font-bold text-lg rounded-lg shadow-md p-5 hover:bg-slate-300"
                    href="register">testbutton to register</button>
            </span>
            <span>
                <button class="bg-white text-black font-bold text-lg rounded-lg shadow-md p-5 hover:bg-slate-300"
                    href="login">testbutton to login</button>
            </span>
            <br>
            <br>
            <p class="text-white font-bold text-4xl">Recommended For You</p>
            <br>
            <div class="bg-opacity-20 rounded-md bg-black p-3">
                <!--load tasks here-->
                <!--script to load user tasks-->

                <p id="usertasks">test</p>
                <script>
                    fetch("/database/users/" + getCookieValue("username") + ".json")
                        .then(response => response.json())
                        .then(data => {
                            document.getElementById("usertasks").textContent = JSON.stringify(data);
                        })
                        .catch(error => {
                            console.error('Error fetching user tasks:', error);
                        });
                </script>
            </div>
        </div>
    </div>



    <!--Add Task div-->
    <div id="addtaskdiv" class="fixed inset-0 flex items-center justify-center z-50">
        <div class="w-80 bg-white rounded-lg shadow-lg p-2">
            <form id="addtaskform" action="http://localhost:3000/addtask/submit" method="POST">
                <p class="font-bold text-lg text-center">Add Task</p>
                <hr class="m-3">
                <label for="addtaskname">Task Name:</label>
                <input type="text" id="addtaskname" name="addtaskname" class="border-2 border-slate-200 rounded-lg"
                    required>
                <br>
                <br>
                <label for="addtaskdatetime">Due Date:</label>
                <input type="datetime-local" id="addtaskdatetime" name="addtaskdatetime"
                    class="border-2 border-slate-200 rounded-lg" required>
                <br>
                <br>
                <label for="addtaskpoints">Points:</label>
                <input type="number" id="addtaskpoints" name="addtaskpoints"
                    class="border-2 border-slate-200 rounded-lg" required>
                <br>
                <br>
                <label for="addtasklength">Hours To Complete:</label>
                <input type="number" id="addtasklength" name="addtasklength"
                    class="border-2 border-slate-200 rounded-lg" required>
                <br>
                <br>
                <input type="hidden" name="addtaskusername" id="addtaskusername">

                <button name="addtasksubmit" class="border-2 border-slate-200 rounded-lg pl-3 pr-3"
                    type="submit">Add</button>
                <button type="button" name="addtaskcancel" onclick="addnewtaskclose()"
                    class="border-2 border-slate-200 rounded-lg pl-3 pr-3">Cancel</button>
            </form>
            <script>
                const usernamesubmit = document.getElementById("addtaskusername");
                usernamesubmit.value = getCookieValue("username")
            </script>
        </div>
    </div>


</body>

</html>