<!DOCTYPE html>
<html>

<head>
    <title>User Page</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        function getCookieValue(cookieName) {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.startsWith(cookieName + '=')) {
                    return cookie.substring(cookieName.length + 1);
                }
            }
            return '';
        }

        function addnewtask() {
            //code to open add task menu on center of screen
            document.getElementById("addtaskdiv").style.display = "flex";
        }

        function addnewtaskclose() {
            document.getElementById("addtaskdiv").style.display = "none";
        }

        function welcomedisplay() {
            var date = new Date();
            document.getElementById("welcomedisplay").textContent = date + " - Welcome " + getCookieValue("username");
            //document.getElementById("welcomedisplay").textContent = (date.getMonth() + 1) + "-" + date.getDate() + ", " + date.toLocaleTimeString() + " - Welcome " + getCookieValue("username");
        }

        function allthestuff() {
            setInterval(welcomedisplay, 100);
            welcomedisplay();
            document.getElementById("addtaskdiv").style.display = "none";
            document.getElementById("removetaskdiv").style.display = "none";
        }

        function removetask() {
            document.getElementById("removetaskdiv").style.display = "flex";
        }

        function removetaskclose() {
            document.getElementById("removetaskdiv").style.display = "none";
        }

    </script>
</head>

<body onload="allthestuff()" class="bg-orange-700">
    <div id="hiddenstuff" class="hidden">
        <div id="tasktemplate" class="bg-white rounded-md w-60 max-h-64 overflow-auto inline-block m-3 p-2">
            <p id="taskname">Task Name</p>
            <p id="taskdue">Task Due Date</p>
            <p id="taskpoints">Task Points</p>
            <p id="tasklength">Task Length</p>
        </div>
    </div>
    <div class="bg-gradient-to-b from-orange-400 to-orange-700 flex flex-col">
        <div class="h-screen p-3">
            <div class="bg-black bg-opacity-20 shadow-lg rounded-md flex-grow flex-shrink-0 p-2 h-48">

            </div>
            <br>
            <p id="welcomedisplay" class="text-white font-bold text-4xl">lmao if you see this the webpage messed up lol
            </p>
            <br>

            <span>
                <button class="bg-white text-black font-bold text-lg rounded-lg shadow-md p-5 hover:bg-slate-300"
                    onclick="addnewtask()">Add Task</button>
            </span>
            <span>
                <button class="bg-white text-black font-bold text-lg rounded-lg shadow-md p-5 hover:bg-slate-300"
                    onclick="removetask()">Remove Task</button>
            </span>
            <span>
                <button class="bg-white text-black font-bold text-lg rounded-lg shadow-md p-5 hover:bg-slate-300"
                    href="login">testbutton2</button>
            </span>
            <br>
            <br>
            <p class="text-white font-bold text-4xl">Recommended For You</p>
            <label for="sortby" class="text-white font-bold text-2xl">Sort By: </label>
            <select name="sortby" id="sortby">
                <option value="default">Order Added</option>
                <option value="mosturgent">Most Urgent</option>
                <option value="mostpoints">Most Points</option>
                <option value="mostime">Most Time</option>
                <option value="formula">Formula</option>
            </select>
            <p name="pisscum" id="pisscum">asrolfkghdsfladksfhj</p>
            <br>
            <br>
            <div id="taskcontainer"
                class="bg-opacity-20 rounded-md bg-black p-3 max-h-72 overflow-x-clip overflow-y-auto">




                <!--load tasks here-->
                <!--script to load user tasks-->

                <!--<p class="inline-block" id="usertasks">test</p>-->
                <script>




                    document.getElementById("pisscum").textContent = document.getElementById("sortby").value;

                    fetch("/database/users/" + getCookieValue("username") + ".json")
                        .then(response => response.json())
                        .then(data => {
                            const basedata = data.tasks;
                            const neworder = [];
                            //sorting and filter shit
                            for (let index = 0; index < basedata.length; index++) {
                            
                            };
                                switch (document.getElementById("sortby").value) {
                                    case "default":
                                    
                                    case "mosturgent":

                                    case "mostpoints":

                                    case "mosttime":

                                    case "formula":

                                }

                            listdata = basedata;

                            //document.getElementById("usertasks").textContent = JSON.stringify(data);
                            for (let index = 0; index < listdata.length; index++) {
                                const element = listdata[index];
                                const taskclone = document.getElementById("tasktemplate").cloneNode(true);
                                taskclone.id = "task" + index;
                                taskclone.querySelector("#taskname").textContent = element.addtaskname;
                                setInterval(function () {
                                    const current = new Date();
                                    const duedate = new Date(element.addtaskdatetime);
                                    const remaining = duedate - current;
                                    taskclone.querySelector("#taskdue").textContent = "In " + Math.floor((remaining) / (1000 * 60 * 60 * 24)) + " Days, " + (Math.floor(remaining / (1000 * 60 * 60)) % 24) + " Hours, " + (Math.floor(remaining / (1000 * 60)) % (60)) + " Minutes, " + (Math.floor(remaining / (1000)) % 60) + " Seconds";
                                }, 1000);

                                taskclone.querySelector("#taskpoints").textContent = element.addtaskpoints + " Points";
                                taskclone.querySelector("#tasklength").textContent = element.addtasklength + " Hours To Complete";
                                document.getElementById("taskcontainer").appendChild(taskclone);
                            }
                        })
                        .catch(error => {
                            console.error('Error fetching user tasks:', error);
                        });



                    document.getElementById("sortby").addEventListener("change", () => {
                        document.getElementById("pisscum").textContent = document.getElementById("sortby").value;
                    });
                </script>
            </div>
        </div>
    </div>



    <!--Add Task div-->
    <div id="addtaskdiv" class="fixed inset-0 flex items-center justify-center z-50">
        <div class="w-80 bg-white rounded-lg shadow-lg p-2">
            <form id="addtaskform" action="http://localhost:3000/addtask/submit" method="POST">
                <p class="font-bold text-lg text-center">Add Task</p>
                <hr class="m-3">
                <label for="addtaskname">Task Name:</label>
                <input type="text" id="addtaskname" name="addtaskname" class="border-2 border-slate-200 rounded-lg"
                    required>
                <br>
                <br>
                <label for="addtaskdatetime">Due Date:</label>
                <input type="datetime-local" id="addtaskdatetime" name="addtaskdatetime"
                    class="border-2 border-slate-200 rounded-lg" required>
                <br>
                <br>
                <label for="addtaskpoints">Points:</label>
                <input type="number" id="addtaskpoints" name="addtaskpoints"
                    class="border-2 border-slate-200 rounded-lg" required>
                <br>
                <br>
                <label for="addtasklength">Hours To Complete:</label>
                <input type="number" id="addtasklength" name="addtasklength"
                    class="border-2 border-slate-200 rounded-lg" required>
                <br>
                <br>
                <input type="hidden" name="addtaskusername" id="addtaskusername">

                <button name="addtasksubmit" class="border-2 border-slate-200 rounded-lg pl-3 pr-3"
                    type="submit">OK</button>
                <button type="button" name="addtaskcancel" onclick="addnewtaskclose()"
                    class="border-2 border-slate-200 rounded-lg pl-3 pr-3">Cancel</button>
            </form>
            <script>
                const addusernamesubmit = document.getElementById("addtaskusername");
                addusernamesubmit.value = getCookieValue("username")
            </script>
        </div>
    </div>

    <!--Remove Task div-->
    <div id="removetaskdiv" class="fixed inset-0 flex items-center justify-center z-50">
        <div class="w-80 bg-white rounded-lg shadow-lg p-2">
            <form id="removetaskform" action="http://localhost:3000/removetask/submit" method="POST">
                <p class="font-bold text-lg text-center">Remove Task</p>
                <hr class="m-3">
                <label for="removetaskname">Task Name:</label>
                <input type="text" id="removetaskname" name="removetaskname"
                    class="border-2 border-slate-200 rounded-lg" required>
                <br>
                <br>

                <input type="hidden" name="removetaskusername" id="removetaskusername">

                <button name="rmeovetasksubmit" class="border-2 border-slate-200 rounded-lg pl-3 pr-3"
                    type="submit">OK</button>
                <button type="button" name="removetaskcancel" onclick="removetaskclose()"
                    class="border-2 border-slate-200 rounded-lg pl-3 pr-3">Cancel</button>
            </form>
            <script>
                const removeusernamesubmit = document.getElementById("removetaskusername");
                removeusernamesubmit.value = getCookieValue("username");
            </script>
        </div>
    </div>


</body>

</html>